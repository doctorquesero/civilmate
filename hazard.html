<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hazard Alert - CivilMate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>body { background-color: #1a1a1a; font-family: sans-serif; }</style>
</head>
<body class="p-4 text-white max-w-lg mx-auto">

    <header class="mb-6 flex justify-between items-center border-b border-gray-700 pb-4">
        <div>
            <h1 class="text-2xl font-bold text-orange-500">⚠️ Hazard Alert</h1>
            <p class="text-xs text-gray-400">Report unsafe conditions</p>
        </div>
        <a href="hs_menu.html" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></a>
    </header>

    <div class="space-y-6">
        <div>
            <label class="block text-sm font-bold text-gray-400 mb-1">Location</label>
            <input type="text" id="loc" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:border-orange-500 outline-none text-white" placeholder="e.g. Entrance Gate">
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-400 mb-1">Risk Level</label>
            <div class="grid grid-cols-3 gap-3">
                <button onclick="setRisk('Low')" id="btnLow" class="risk-btn p-3 rounded-lg border border-gray-600 hover:bg-yellow-900/50 text-yellow-500 font-bold text-sm">LOW</button>
                <button onclick="setRisk('Medium')" id="btnMed" class="risk-btn p-3 rounded-lg border border-gray-600 hover:bg-orange-900/50 text-orange-500 font-bold text-sm">MED</button>
                <button onclick="setRisk('High')" id="btnHigh" class="risk-btn p-3 rounded-lg border border-gray-600 hover:bg-red-900/50 text-red-500 font-bold text-sm">HIGH</button>
            </div>
            <input type="hidden" id="riskValue">
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-400 mb-1">Description</label>
            <textarea id="desc" rows="3" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl focus:border-orange-500 outline-none text-white" placeholder="Describe hazard..."></textarea>
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-400 mb-2">Photo</label>
            <label class="block w-full p-4 border-2 border-dashed border-gray-600 rounded-xl cursor-pointer hover:border-orange-500 bg-gray-800/50 text-center">
                <i class="fas fa-camera text-2xl text-gray-500"></i>
                <input type="file" id="photoInput" class="hidden" accept="image/*" onchange="previewPhoto(this)">
            </label>
            <img id="photoPreview" class="mt-4 w-full h-48 object-cover rounded-xl hidden border border-gray-600">
        </div>

        <button onclick="submitHazard()" class="w-full bg-orange-600 text-white py-4 rounded-xl font-bold text-xl hover:bg-orange-500 mt-4">Broadcast Alert</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBcgFroLuH-8AQ_0uXmCffnYpEkJZEeBYk",
            authDomain: "civilmate-933db.firebaseapp.com",
            projectId: "civilmate-933db",
            storageBucket: "civilmate-933db.firebasestorage.app",
            messagingSenderId: "679829297548",
            appId: "1:679829297548:web:42f9a5217314b787ed9ea9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function setRisk(level) {
            document.getElementById('riskValue').value = level;
            document.querySelectorAll('.risk-btn').forEach(b => b.classList.remove('ring-2', 'bg-opacity-50'));
            // Lógica visual simplificada
        }

        let photoBase64 = null;
        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    photoBase64 = e.target.result;
                    document.getElementById('photoPreview').src = photoBase64;
                    document.getElementById('photoPreview').classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function submitHazard() {
            const loc = document.getElementById('loc').value;
            const risk = document.getElementById('riskValue').value;
            const desc = document.getElementById('desc').value;
            
            if(!loc || !risk) return alert("Fill details");
            
            document.querySelector('button').innerText = "Sending...";
            db.collection('hazards').add({
                location: loc, risk: risk, description: desc, photo: photoBase64, timestamp: Date.now()
            }).then(() => { alert("Reported!"); window.location.href="hs_menu.html"; });
        }
    </script>
</body>
</html>
